#include "iom128v.h"
#include "macros.h"
void delay(int t)
{
	int c1,c2;
	for(c1=0;c1<t;c1++)
    {
    	for(c2=0;c2<970;c2++)
        {
        	NOP();
        }
    }
}

char scan_buttons() // функция считывания состояния с кнопок
{
  char t, d=0;
  DDRA=0;		   // порт А настроен на вход для считывания данных с кнопок
  PORTD=0x80;	   // уст. лог. 1 на выводе PD7 для управления регистром клавиатуры
  t=PINA;		   // считывание значения с шины данных
  PORTD=0;		   // перевод регистра клавиатуры в высокоимпедансное состояние
  DDRA=0xFF;	   // настройка порта А на выход
  DDRG=0x01;	   // разрешение работы дешифратора
  PORTG=0;	 	   // установка на выходе PG0 лог. 0
  // преобразование данных, полученных с кнопок для удобства использования
  if((t&0x10)==0) d=1;	
  if((t&0x20)==0) d=-1;
  if((t&0x40)==0) d=0;
  if((t&0x80)==0) d=1;
  if((t&0x01)==0) d=1;
  if((t&0x02)==0) d=1;
  if((t&0x04)==0) d=1;
  if((t&0x08)==0) d=1;
  return d;	  // значение возвращается из функции с инверсией
}

void main()
{
 	char seg[10]={0b01110111, 0b01100000, 0b00111110, 0b01111010, 0b01101001,
0b01011011, 0b01011111, 0b01110000,0b01111111, 0b01111011};
int i,t;
DDRC=0b10000111; // ?????????? ???????????? ???? ??????
DDRA=0xFF; // ???? ??????
DDRG=0x01; // ?????????? ?????? ???????????
PORTG=0; // ????????? ?? ?????? PG0 ???. 0
PORTA=0; // ????????? ???????? ?????????? ??????????
PORTC=0; // ???????? ???????
PORTC=5; // ???????? ??????
while(1)
{
 t=scan_buttons();
 if(t==1)i++;
 else if(t==-1)
 {
  if(i==0) {i=9999;}
  i--;
 }

 else if(t==0)i=0;
 PORTC=6; // ????????? ?????????? ?6
 PORTA=~seg[i/1000]; //????? ? ???? ???????? ?????
 PORTC=7; // ????????? ?????????? ?7
 PORTA=~seg[(i%1000)/100]; //????? ? ???? ???????? ?????
 PORTC=1; // ????????? ?????????? ?8
 PORTA=~seg[((i%1000)%100)/10]; //????? ? ???? ???????? ???????
 PORTC=2; // ????????? ?????????? ?9
 PORTA=~seg[((i%1000)%100)%10]; //????? ? ???? ???????? ?????? 

 }
}




